import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { FCM, NotificationData } from '@ionic-native/fcm/ngx';
import { Observable, from } from 'rxjs';
import { environment } from '@environments/environment';
import { PushPayload } from 'shared';

@Injectable({
  providedIn: 'root'
})
export class PushService {

  constructor(private http: HttpClient,
    private fcm: FCM) { }

  getPushToken(): Observable<string> {
    return from(this.fcm.getToken());
  }

  listenToNotifications(): Observable<NotificationData> {
    return this.fcm.onNotification();
  }

  listenToTokenRefresh(): Observable<string> {
    return this.fcm.onTokenRefresh();
  }

  registerPushToken(payload: PushPayload) {
    return this.http
      .post(`${environment.baseURL}/appapi/push/register`, payload);
  }

  unregisterPushToken(payload: PushPayload) {
    return this.http
      .post(`${environment.baseURL}/api/push/unregister`, payload);
  }
}

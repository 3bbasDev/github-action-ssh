<form [formGroup]="inspectionForm" (ngSubmit)="inspect(bar)">
  <ion-card>
    <fiv-loading-progress-bar (fivComplete)="inspectionComplete($event)" #bar></fiv-loading-progress-bar>
    <ion-card-header>
      <ion-card-title>{{kriterium.name}}</ion-card-title>
      <ion-card-subtitle>{{kriterium.category.name}}</ion-card-subtitle>
      <img #picto class="picto" *ngIf="picto" [src]="picto">
    </ion-card-header>
    <ion-card-content *ngIf="!done">
      <ion-item>
        <ion-label>Alles in Ordnung</ion-label>
        <ion-checkbox formControlName="result" slot="end"></ion-checkbox>
      </ion-item>
      <fiv-expandable #ex (fivDidOpen)="note.setFocus()">
        <ion-item content>
          <ion-textarea #note placeholder="Notiz hinzufügen" formControlName="description"></ion-textarea>
        </ion-item>
      </fiv-expandable>
      <ion-chip *ngIf="assignedUser.value" color="primary">
        <ion-label *ngIf="inspectionForm.value.assignedUserId | userByID : (users | async) as m">{{m.firstname}} {{m.lastname}}</ion-label>
      </ion-chip>
    </ion-card-content>
    <ion-card-content *ngIf="done">
      Der Prüfpunkt wurde bereits geprüft
    </ion-card-content>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ng-container *ngIf="context | async as c">
            <ng-container *ngIf="user | async as u">
              <ng-container *ngIf="property | async as p">
                  <ion-button *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]" (click)="presentUserSelection(c,p)">
                      <ion-icon slot="icon-only" name="md-person-add"></ion-icon>
                    </ion-button>
              </ng-container>
              </ng-container>
        </ng-container>
      
        <ion-button *ngIf="!image" (click)="takePicture()">
          <ion-icon slot="icon-only" name="md-camera"></ion-icon>
        </ion-button>
        <fiv-image-viewer (fivActionClick)="onActionClick($event)" width="50" *ngIf="image" [src]="image" [actions]="[{icon: 'md-trash', name: 'Bild löschen'},{icon: 'md-refresh', name: 'Neues Foto'}]"></fiv-image-viewer>
        <ion-button (click)="expandable.toggle()">
          <ion-icon slot="icon-only" name="md-text"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-buttons slot="end">
        <ion-button [disabled]="inspectionForm.invalid" type="submit" color="primary">
          absenden
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-card>
</form>
package de.fivethree.immoapps.backend.service;

import de.fivethree.immoapps.backend.model.mail.InspectionFinishedSummary;
import de.fivethree.immoapps.backend.model.mail.NewOpenInspectionMail;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserMailService {

    @Autowired
    private MailService mailService;

    private static final Logger log = LoggerFactory.getLogger(UserMailService.class);

    public void sendRegistrationMail(String email, String fullName, String password) {
        final String subject = "immoapp Zugang";
        final String html = "Hallo " + fullName + ",<br /><br />" +
                "Sie wurden als Hausverwalter dem System immoapp hinzugefügt.<br /><br />" +
                "Ihr Initialpasswort lautet: " + password + "<br /><br />" +
                "Sie können Ihr Password jederzeit im System ändern.<br /><br />" +
                "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);
        log.info("Passwort: " + password);
    }

    public void sendRegistrationMailMitarbeiter(String email, String fullNameUser, String fullNameHausverwalter,
                                                String password) {
        final String subject = "immoapp Zugang";
        final String html = "Hallo " + fullNameUser + ",<br /><br />" +
                "Sie wurden von " + fullNameHausverwalter + " in das System immoapp aufgenommen.<br /><br />" +
                "Ihr Initialpasswort lautet: " + password + "<br /><br />" +
                "Sie können Ihr Password jederzeit im System ändern.<br /><br />" +
                "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);

        log.info("Passwort: " + password);
    }

    public void sendRegistrationMailHausmeister(String email, String fullNameUser,
                                                String fullNameHausverwalter, String password) {
        final String subject = "immoapp Zugang";
        final String html = "Hallo " + fullNameUser + ",<br /><br />" +
                "Sie wurden von " + fullNameHausverwalter + " für die App immoapp freigeschaltet.<br /><br />" +
                "Ihr Initialpasswort zum Login lautet: " + password + "<br /><br />" +
                "Sie können Ihr Password jederzeit in der App ändern.<br /><br />" +
                "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);

        log.info("Passwort: " + password);
    }

    public void sendPasswordResetMail(String email, String fullName, String randomPassword) {
        final String subject = "immoapp Passwortzurücksetzung";
        final String html = "Hallo " + fullName + ",<br /><br />" +
                "Ihr Passwort wurde auf den folgenden Wert zurückgesetzt: " + randomPassword + "<br /><br />" +
                "Sie können Ihr Password jederzeit im System ändern.<br /><br />" +
                "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);

        log.info("Passwort: " + randomPassword);
    }

    public void sendPasswordForgetRequestMail(String email, String fullName, String resetLink) {
        final String subject = "immoapp Passwortzurücksetzung";
        final String html = "Hallo " + fullName + ",<br /><br />" +
                "Für Ihre Emailadresse wurde eine Passwortzurücksetzung beantragt.<br />" +
                "Klicken Sie bitte auf den folgenden Link, um Ihr Passwort zurückzusetzen.<br />" +
                "Anschließend erhalten Sie eine weitere Email mit einem neuen, zufällig generierten Passwort.<br /><br />" +
                "<a href='" + resetLink + "' target='_blank'>" + resetLink + "</a><br /><br />" +
                "Bitte beachten Sie, dass dieser Link nach 48h seine Gültigkeit verliert.<br /><br />" +
                "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);
    }

    public void sendInspectionFinishedMail(String email, String fullName,
                                           InspectionFinishedSummary inspectionFinishedSummary, boolean ignoreError) {
        final String subject = "immoapp neue abgeschlossene Inspektion";
        final String html = "Hallo " + fullName + ",<br /><br />" +
                "Für Ihre Immobilie: " + inspectionFinishedSummary.getPropertyName()
                + " wurde eine Inspektion vom Nutzer: " + inspectionFinishedSummary.getInspectionUserName()
                + " (Email: " + inspectionFinishedSummary.getInspectionUserEmail() + ")"
                + " über " + inspectionFinishedSummary.getKriterienCount()
                + " Prüfpunkten abgeschlossen.<br /><br />"
                + "Es liegen " + inspectionFinishedSummary.getIssuesCount() + " Mängel vor und "
                + inspectionFinishedSummary.getSuccessCount() + " Prüfpunkte weisen keine Mängel auf.<br /><br />"
                + "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);
    }

    public void sendNewOpenInspectionMail(String email, String fullName, NewOpenInspectionMail newOpenInspectionMail) {
        final String subject = "immoapp neue offene Inspektion";

        String hausverWaltungOpt = newOpenInspectionMail.getHausverwaltung() != null
                && !newOpenInspectionMail.getHausverwaltung().isEmpty() ?
                " von der Hausverwaltung: " + newOpenInspectionMail.getHausverwaltung() : "";

        final String html = "Hallo " + fullName + ",<br /><br />" +
                "Für die Immobilie: " + newOpenInspectionMail.getProperty()
                + hausverWaltungOpt
                + " wurde für Sie eine neue Inspektion "
                + " von dem Nutzer: " + newOpenInspectionMail.getAuftragGeberFullname()
                + " (Email: " + newOpenInspectionMail.getAuftragGeberEmail() + ")"
                + " mit " + newOpenInspectionMail.getKriterienCount()
                + " Prüfpunkten angelegt.<br /><br />"
                + "Sie können diese Inspektion in Ihrer App nun einsehen und vornehmen.<br /><br />"
                + "Mit freundlichen Grüßen,<br />Ihr immoapp Team";
        this.mailService.sendHTMLMail(email, subject, html);
    }
}

<ion-card *ngIf="checklist?.levels[level] as l">
  <fiv-loading-progress-bar #bar (fivComplete)="onComplete($event,ex)"></fiv-loading-progress-bar>
  <fiv-loading-progress-bar #bar2 (fivComplete)="onTitleChangeComplete($event)"></fiv-loading-progress-bar>
  <ion-toolbar color="translucent">
    <app-editable [component]="'TITLE'" (save)="changeTitle($event,bar2)" #title [title]="l.name"></app-editable>
    <ion-buttons slot="end">
      <ion-button [disabled]="title.editing && !title.isValid()" (click)="title.editing ? changeTitle(title,bar2) : title.edit()"
        [matTooltip]="title.editing ? 'Änderungen speichern' : 'Prübereich umbenennen'">
        <fiv-icon [name]="title.editing ? 'md-save' : 'md-create'"></fiv-icon>
      </ion-button>

      <ion-button (click)="title.editing ? title.reset(): delete()" [matTooltip]="title.editing ? 'Änderungen verwerfen' : 'Prüfbereich löschen'">
        <fiv-icon [name]="title.editing ? 'md-close' : 'md-trash'"></fiv-icon>
      </ion-button>

    </ion-buttons>
  </ion-toolbar>
  <ion-card-content>

    <app-kriterium [property]="property" (fivChange)="onChange($event)" [isAdmin]="isAdmin" (kriteriumDeleted)="onKriteriumDeleted($event)"
      [checklist]="checklist" [level]="level" [kriterium]="k" *ngFor="let kriterium of l.kriterien; let k = index"></app-kriterium>
    <fiv-expandable #ex (fivDidOpen)="add.setFocus()" (fivDidClose)="onDidClose($event)">

      <ion-list content>
        <form [formGroup]="addKriteriumForm">
          <ion-item>
            <ion-label position="floating">Prüfkriterium anlegen</ion-label>
            <ion-input formControlName="name" type="text" #add></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="floating">Kategorie wählen</ion-label>
            <ion-select [placeholder]="addKriteriumForm.value.category" formControlName="category">
              <ion-select-option *ngFor="let cat of categories" [value]="cat.id">{{cat.name}}</ion-select-option>
            </ion-select>
          </ion-item>
        </form>
        <ion-toolbar color="translucent">
          <ion-buttons slot="end">
            <ion-button color="danger" *ngIf="ex.isOpen" (click)="ex.close()">
              Abbrechen
            </ion-button>
            <ion-button *ngIf="ex.isOpen" [disabled]="addKriteriumForm.invalid" (click)="addKriterium(bar)">
              Speichern
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-list>

    </fiv-expandable>
    <ion-footer>
      <ion-toolbar color="translucent">
        <ion-buttons slot="end">
          <ion-button (click)="ex.isOpen ? add.setFocus() : ex.open()">
            Prüfkriterium hinzufügen
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ion-card-content>
</ion-card>
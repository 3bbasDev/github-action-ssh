import { JwtHelperService } from '@auth0/angular-jwt';
import { Injectable } from '@angular/core';
import { Storage } from '@ionic/storage';
import {BehaviorSubject} from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class TokenService {

  private token: string;
  public loggedIn: BehaviorSubject<boolean> = new BehaviorSubject(false);

  constructor(private storage: Storage) {
   }

  getToken(){
    return this.token;
  }

  setToken(token: string){
    this.token = token;
    this.storage.set('TOKEN',token);
  }

  loadToken(): Promise<boolean>{
    return this.storage.get('TOKEN')
    .then(token => {
      this.token = token;
      if(token){
        this.loggedIn.next(true);
      }
      return token;
    });
  }

  removeToken(){
    this.token = null;
    this.setToken(this.token);
    this.loggedIn.next(false);

  }
}

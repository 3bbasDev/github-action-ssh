<ion-header>
  <ion-toolbar>
    <ion-title>{{(user | async)?.firstname}} {{(user | async)?.lastname}} ({{(user | async)?.email}})</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/hausverwalter"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content padding>

  <ion-grid fixed>
    <ion-row>
      <ion-col size="12">
        <app-breadcrumb></app-breadcrumb>
        <ion-card *ngIf="(user | async) as u">
          <fiv-loading-progress-bar (fivComplete)="exportComplete($event)" #bar></fiv-loading-progress-bar>
          <fiv-loading-progress-bar (fivComplete)="importComplete($event)" #bar2></fiv-loading-progress-bar>
          <ion-toolbar>
            <ion-title>{{u?.email}}</ion-title>
            <fiv-buttons slot="end" [count]="1">
              <fiv-button [icon]="'md-create'" [matTooltip]="u?.email + ' bearbeiten'"  [text]="u?.email + ' bearbeiten'" [matTooltip]="u?.email + ' bearbeiten'"
                (click)="editUser(u)">
              </fiv-button>
              <fiv-button [icon]="'md-refresh'" [text]="'Passwort zurücksetzen'" [matTooltip]="'Passwort zurücksetzen'"
                (click)="presentAlertConfirm(u)">
              </fiv-button>
              <fiv-button [icon]="'md-trash'" [text]="'Hausverwaltung löschen'" (click)="confirmDeletion(u)">
              </fiv-button>
              <fiv-button [icon]="'md-cloud-download'" [text]="'Immobilien als CSV exportieren'"
                (click)="exportCSV(u,bar)">
              </fiv-button>
              <fiv-button [icon]="'md-cloud-upload'" [text]="'Immobilien als CSV importieren'" (click)="upload.click()">
              </fiv-button>
              <input style="visibility: hidden;" #upload type="file" accept=".csv" ngf-max-size="20MB"
                (change)="importCSV($event,u,bar2)" />
            </fiv-buttons>
          </ion-toolbar>
          <ion-card-content class="no-lines">
            <ion-list>
              <ion-item>
                <ion-label slot="start">
                  Vorname
                </ion-label>
                <div slot="end">
                  {{u?.firstname}}
                </div>
              </ion-item>
              <ion-item>
                <ion-label slot="start">
                  Nachname
                </ion-label>
                <div slot="end">
                  {{u?.lastname}}
                </div>
              </ion-item>
              <ion-item>
                <ion-label slot="start">
                  E-Mail
                </ion-label>
                <div slot="end">
                  {{u?.email}}
                </div>
              </ion-item>
              <ion-item-divider>
                <span translate>Rollen</span>
              </ion-item-divider>

              <ion-item *ngIf="u?.role">
                <ion-chip class="chip">{{u?.role | role}}</ion-chip>
              </ion-item>
              <ng-container *ngIf="u?.additionalInfo">
                <ion-item-divider>
                  <ion-label>Weitere Informationen</ion-label>
                </ion-item-divider>
                <ion-item>
                  <ion-label slot="start">
                    Firma
                  </ion-label>
                  <div slot="end">
                    {{u?.additionalInfo.companyName}}
                  </div>
                </ion-item>
                <ion-item>
                  <ion-label slot="start">
                    Adresse
                  </ion-label>
                  <div slot="end">
                    {{u?.additionalInfo.streetAndNo}}, {{u?.additionalInfo.zip}} {{u?.additionalInfo.city}}
                  </div>
                </ion-item>
                <ion-item>
                  <ion-label slot="start">
                    Telefon
                  </ion-label>
                  <div slot="end">
                    {{u?.additionalInfo.telephone}}
                  </div>
                </ion-item>
                <ion-item>
                  <ion-label slot="start">
                    Website
                  </ion-label>
                  <div slot="end">
                    {{u?.additionalInfo.website}}
                  </div>
                </ion-item>
                <ion-item>
                  <ion-label slot="start">
                    Fax
                  </ion-label>
                  <div slot="end">
                    {{u?.additionalInfo.fax}}
                  </div>
                </ion-item>
              </ng-container>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <ion-card *ngIf="(user | async) as u">
          <ion-toolbar>
            <ion-title>Statistik der Hausverwaltung</ion-title>
          </ion-toolbar>
          <ion-card-content>
            <form [formGroup]="period" (ngSubmit)="getReport(u)">
              <mat-form-field>
                <input matInput [max]="to.value" [matDatepicker]="picker1" placeholder="Startdatum"
                  formControlName="from" [formControl]="from">
                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                <mat-datepicker #picker1></mat-datepicker>
              </mat-form-field>
              <mat-form-field>
                <input matInput [min]="from.value" [matDatepicker]="picker2" placeholder="Enddatum" formControlName="to"
                  [formControl]="to">
                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                <mat-datepicker #picker2></mat-datepicker>
              </mat-form-field>
              <ion-button class="form-button" color="primary" type="submit" [disabled]="period.invalid">
                Bericht ansehen
              </ion-button>
            </form>

            <ng-container *ngIf="stats | async as s">
              <ion-chip>
                <ion-label>{{s.inspectionsFinishedCount}} Inspektionen durchgeführt</ion-label>
              </ion-chip>
              <ion-chip>
                <ion-label>{{s.mitarbeiterCreationCount}} Mitarbeiter angelegt</ion-label>
              </ion-chip>
              <ion-chip>
                <ion-label>{{s.userCreationCount}} Hausmeister angelegt</ion-label>
              </ion-chip>
              <ion-chip>
                <ion-label>{{s.propertyCreationCount}} Immobilien angelegt</ion-label>
              </ion-chip>
            </ng-container>

          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>



</ion-content>
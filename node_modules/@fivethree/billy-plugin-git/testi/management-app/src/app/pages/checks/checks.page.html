<ion-header>
    <ion-toolbar>
        <ion-buttons slot="start">
            <ion-back-button defaultHref="/"></ion-back-button>
        </ion-buttons>
        <ion-title>Begehungen</ion-title>
    </ion-toolbar>
</ion-header>

<ion-content padding>

    <ion-grid *fivIf="['desktop']" fixed>
        <ion-row>
            <ion-col size="12">
                <app-breadcrumb></app-breadcrumb>
                <ion-card>
                    <fiv-toolbar-search (close)="onSearchbarClose()" (fivInputChange)="applySearchFilter($event)"
                        placeholder="Begehung suchen" title="Begehungen verwalten">
                    </fiv-toolbar-search>
                    <ion-card-header>
                        <ion-card-subtitle>Begehungen einsehen und anlegen</ion-card-subtitle>
                    </ion-card-header>
                    <ion-card-content>
                        <ion-button (click)="createInspection()">
                            Neue Inspektion anlegen
                        </ion-button>
                        <table mat-table [dataSource]="dataSource" class="mat-elevation-z0" matSort>

                            <ng-container matColumnDef="property">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Immobilie</th>
                                <td mat-cell *matCellDef="let element">
                                    <ng-container
                                        *ngIf="(element.propertyId | propertyByID : (properties | async)) as p">
                                        {{p.address}}
                                    </ng-container>
                                </td>
                            </ng-container>

                            <ng-container matColumnDef="userId">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Durchgeführt von</th>
                                <td mat-cell *matCellDef="let element">
                                    <ng-container *ngIf="(element.userId | userByID : (users | async)) as u">
                                        {{u.firstname}} {{u.lastname}}
                                    </ng-container>
                                </td>
                            </ng-container>

                            <ng-container matColumnDef="criterias">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Prüfpunkte</th>
                                <td mat-cell *matCellDef="let element">
                                    {{ element.criterias.length == 1 ? '1 Prüfpunkt' : element.criterias.length + '
                                    Prüfpunkte'}}</td>
                            </ng-container>
                            <ng-container matColumnDef="results">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Ergebnisse</th>
                                <td mat-cell *matCellDef="let element"> {{ element.results.length == 1 ? '1 Ergebnis' :
                                    element.results.length + '
                                    Ergebnisse'}}</td>
                            </ng-container>

                            <ng-container matColumnDef="done">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header>Abgeschlossen</th>
                                <td mat-cell *matCellDef="let element">
                                    {{element.done ? 'abgeschlossen' : 'offen'}}
                                </td>
                            </ng-container>



                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClicked(row)">
                            </tr>
                        </table>
                        <mat-paginator [pageSizeOptions]="[15, 30, 50, 100]" showFirstLastButtons></mat-paginator>
                    </ion-card-content>
                </ion-card>

            </ion-col>
        </ion-row>
    </ion-grid>


    <ion-list lines="full" *fivIf="['mobile']">
        <ion-item (click)="navigateToInspection(prop.id)" *ngFor="let inspection of inspections | async">
            <ion-label text-wrap>
                <ion-text>
                    <h3>{{inspection.id}}</h3>
                </ion-text>
            </ion-label>
        </ion-item>
    </ion-list>
</ion-content>
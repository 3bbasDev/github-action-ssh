<ion-header>
  <ion-toolbar>
    <ion-title>Inspektion</ion-title>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/inspections"></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content padding>
  <ion-grid fixed>
    <ion-row>
      <ion-col size="12">
        <app-breadcrumb></app-breadcrumb>
        <ion-card *ngIf="inspection | async as i">
          <fiv-loading-progress-bar (fivComplete)="fivComplete($event)" #bar></fiv-loading-progress-bar>
          <fiv-loading-progress-bar (fivComplete)="deleteComplete($event)" #bar2></fiv-loading-progress-bar>
          <ion-toolbar>
            <ion-title>Begehung von {{(property | async)?.address}}</ion-title>
            <ion-buttons slot="end">
              <ion-button *ngIf="!i.done" (click)="promptDeletion(i,bar2)">
                Begehung löschen
              </ion-button>
              <ion-button [disabled]="!i.done" (click)="downloadPDF(i,bar)">
                Bericht erstellen
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
          <ion-card-header *ngIf="users | async as us">
            <ion-card-subtitle *ngIf="(i.userId | userByID : us) as u">Durchgeführt von {{u.firstname}} {{u.lastname}}

              <ng-container *ngIf="(i.auftragGeberId | userByID : us) as a">
                <ng-container *ngIf="i.userId !== i.auftragGeberId">(Erstellt durch {{a.firstname}} {{a.lastname}})
                </ng-container>

              </ng-container>
              <ion-chip *ngIf="!i.done" color="danger">
                <ion-label>Prüfung nicht vollständig</ion-label>
              </ion-chip>

            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <fiv-stepper>
              <fiv-step [open]="true" [title]="crit.pruefkriterium.name" *ngFor="let crit of i?.criterias">
                <app-inspection-kriterium [inspection]="i" [kriterium]="crit">

                </app-inspection-kriterium>
              </fiv-step>
            </fiv-stepper>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
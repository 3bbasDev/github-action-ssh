package de.fivethree.immoapps.backend.controller.webapp;

import de.fivethree.immoapps.backend.model.payload.req.user.PasswordForgetReq;
import de.fivethree.immoapps.backend.service.PasswordForgetService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import javax.validation.Valid;
import javax.validation.constraints.NotBlank;
import javax.validation.constraints.NotNull;

@RestController
@RequestMapping("/immoapps/api/passwordforget")
public class PasswordForgetController {

    @Autowired
    private PasswordForgetService passwordForgetService;

    @PostMapping
    public ResponseEntity<?> sendForgetEmail(@Valid @NotNull @RequestBody PasswordForgetReq passwordForgetReq) {
        passwordForgetService.sendPasswordForgetEmail(passwordForgetReq.getEmail());
        return ResponseEntity.ok().build();
    }

    @GetMapping("/reset/{uuid}")
    public ResponseEntity<?> resetPassword(@PathVariable(name = "uuid") String uuid) {
        boolean resetSuccessful = passwordForgetService.resetPassword(uuid);
        if (resetSuccessful) {
            return ResponseEntity.ok("<h3>Passwort erfolgreich zurückgesetzt.</h3>");
        } else {
            return ResponseEntity.ok("<h3>Passwort konnte nicht zurückgesetzt werden.</h3>");
        }
    }
}

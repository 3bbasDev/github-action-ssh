package de.fivethree.immoapps.backend.repository.inspection;

import de.fivethree.immoapps.backend.domain.user.User;
import de.fivethree.immoapps.backend.domain.inspection.InspectionImage;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

@Repository
public interface InspectionImageRepository extends JpaRepository<InspectionImage, Long> {

    @Query(value = "SELECT i FROM InspectionImage i " +
            "LEFT JOIN FETCH i.inspectionResult ir " +
            "LEFT JOIN FETCH ir.inspection insp " +
            "LEFT JOIN FETCH insp.property prop " +
            "LEFT JOIN FETCH prop.hausverwalter hvw " +
            "WHERE i.id = :id " +
            "AND hvw.id = :hausverwalterId")
    InspectionImage getImageByIdAndHausverwalter(@Param("id") Long id, @Param("hausverwalterId") Long hausverwalterId);

    @Query(value = "SELECT i FROM InspectionImage i " +
            "LEFT JOIN FETCH i.inspectionResult ir " +
            "LEFT JOIN FETCH ir.inspection insp " +
            "LEFT JOIN FETCH insp.property prop " +
            "LEFT JOIN FETCH prop.users users " +
            "WHERE i.id = :id AND :user IN (users)")
    InspectionImage getImageByIdAndUserContains(@Param("id") Long id, @Param("user") User user);
}

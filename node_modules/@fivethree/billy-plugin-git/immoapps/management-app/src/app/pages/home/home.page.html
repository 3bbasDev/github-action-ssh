<ion-header>
  <ion-toolbar>
    <img height="28px" src="assets/logo.png">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>


  <ion-grid *ngIf="user | async as u" fixed>
    <ion-row>
      <ion-col size="12" sizeXs="12" sizeMd="12" sizeLg="8" sizeXl="8">
        <ion-card *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]">
          <ion-toolbar>
            <ion-title>Letzte Begehungen</ion-title>
          </ion-toolbar>
          <ion-card-content>
            <ng-container *ngIf="(inspections | async) as i">
              <ion-item (click)="goToInspection(inspection.id)" class="highlight"
                *ngFor="let inspection of i | slice : 0 : 5">
                <ng-container *ngIf="inspection.propertyId | propertyByID : (properties | async) as property">
                  <ion-label slot="start">{{property.address}}</ion-label>
                  <p *ngIf="inspection.userId | userByID : (users | async) as hm">
                    {{hm.firstname}} {{hm.lastname}}
                  </p>
                  <ion-chip color="danger" slot="end" *ngIf="!inspection.done">
                    <ion-label>offen</ion-label>
                  </ion-chip>

                  <ion-chip color="primary" slot="end" *ngIf="inspection.done">
                    <ion-label>abgeschlossen</ion-label>
                  </ion-chip>
                </ng-container>

              </ion-item>
            </ng-container>
            <ion-item *ngIf="!(inspections | async) || (inspections | async)?.length == 0">
              <ion-label>Noch keine Begehungen durchgeführt</ion-label>
            </ion-item>
          </ion-card-content>
          <ion-toolbar color="translucent">
            <ion-buttons slot="end">
              <ion-button (click)="goToInspections()">
                Alle ansehen
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-card>
        <ion-card>
          <ion-toolbar>
            <ion-title *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]">Neue
              Checklisten</ion-title>
            <ion-title *fivPermissions="['ROLE_ADMIN']; userPermissions [u.role]">Checklistenvorlagen</ion-title>
          </ion-toolbar>
          <ion-card-content>
            <ion-item class="highlight" (click)="navigateToChecklist(checklist.id,u)"
              *ngFor="let checklist of checklists | async | slice : 0 : 5">

              <ion-label>{{checklist.name}}</ion-label>
              <div slot="end">{{checklist.levels.length == 0 ? 'Noch keine Prüfbereiche angelegt' :
                checklist.levels.length == 1 ? '1 Prüfbereich' : checklist.levels.length + ' Prüfbereiche'}}</div>
            </ion-item>
            <ion-item class="highlight" (click)="navigateToChecklist(checklist.id,u)"
              *ngFor="let checklist of adminchecklists | async | slice : 0 : 5">

              <ion-label>{{checklist.name}}</ion-label>
              <div slot="end">{{checklist.levels.length == 0 ? 'Noch keine Prüfbereiche angelegt' :
                checklist.levels.length == 1 ? '1 Prüfbereich' : checklist.levels.length + ' Prüfbereiche'}}</div>
            </ion-item>
          </ion-card-content>
          <ion-toolbar color="translucent">
            <ion-buttons slot="end">
              <ion-button (click)="navigateToChecklists(u)">
                Alle ansehen
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-card>
        <ng-container *fivPermissions="['ROLE_ADMIN']; userPermissions [u.role]">
          <ng-container *ngTemplateOutlet="us">

          </ng-container>
        </ng-container>
      </ion-col>
      <ion-col size="12" sizeXs="12" sizeLg="4" sizeXl="4" sizeMd="12">
        <ion-card *ngIf="user | async as u">
          <ion-toolbar>
            <ion-title>Mein Profil</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="goToSettings()">
                <fiv-icon name="md-settings"></fiv-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
          <ion-card-content>
            <ion-item>
              <fiv-icon slot="start" name="md-contact"></fiv-icon>
              <ion-label>{{u.firstname}} {{u.lastname}}</ion-label>
            </ion-item>
            <ion-item>
              <fiv-icon slot="start" name="md-mail"></fiv-icon>
              <ion-label>{{u.email}}</ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>
        <ion-card id="actions">
          <ion-toolbar>
            <ion-title>Aktionen</ion-title>
          </ion-toolbar>
          <ion-card-content>
            <ion-item *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]"
              (click)="addUser()">
              <fiv-icon slot="end" name="md-contact"></fiv-icon>
              <ion-label>Benutzer anlegen</ion-label>
            </ion-item>
            <ion-item *fivPermissions="['ROLE_ADMIN']; userPermissions [u.role]" (click)="addHausverwalter()">
              <fiv-icon slot="end" name="md-contact"></fiv-icon>
              <ion-label>Hausverwalter anlegen</ion-label>
            </ion-item>
            <ion-item *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]"
              (click)="addProperty()">
              <fiv-icon slot="end" name="md-business"></fiv-icon>
              <ion-label>Immobilie anlegen</ion-label>
            </ion-item>
            <ion-item *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]"
              (click)="addChecklist()">
              <mat-icon slot="end">playlist_add_check</mat-icon>
              <ion-label>Checkliste anlegen</ion-label>
            </ion-item>
            <ion-item *fivPermissions="['ROLE_ADMIN']; userPermissions [u.role]" (click)="addChecklistTemplate()">
              <mat-icon slot="end">playlist_add_check</mat-icon>
              <ion-label>Checklistenvorlage erstellen</ion-label>
            </ion-item>
          </ion-card-content>
        </ion-card>
        <ng-container *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]">
          <ng-container *ngTemplateOutlet="us">

          </ng-container>
        </ng-container>

        <ng-template #us>
          <ion-card>
            <ion-toolbar>
              <ion-title *fivPermissions="['ROLE_ADMIN']; userPermissions [u.role]">Neue Hausverwalter</ion-title>
              <ion-title *fivPermissions="['ROLE_HAUSVERWALTER','ROLE_MITARBEITER']; userPermissions [u.role]">Neue
                Benutzer</ion-title>
            </ion-toolbar>
            <ion-card-content>
              <ion-item (click)="navigateToUser(user.id,u)" class="highlight"
                *ngFor="let user of users | async | slice : 0 : 4">
                <ion-label>{{user.firstname}} {{user.lastname}}</ion-label>
              </ion-item>
              <ion-item (click)="navigateToUser(user.id,u)" class="highlight"
                *ngFor="let user of verwalter | async | slice : 0 : 4">
                <ion-label>{{user.firstname}} {{user.lastname}}</ion-label>
              </ion-item>
            </ion-card-content>
            <ion-toolbar color="translucent">
              <ion-buttons slot="end">
                <ion-button (click)="navigateToUsers(u)">
                  Alle ansehen
                </ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-card>
        </ng-template>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>
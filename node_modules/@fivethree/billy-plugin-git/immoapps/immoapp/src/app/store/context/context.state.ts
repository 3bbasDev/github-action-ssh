import { ApiService } from '@services/api.service';
import { GetContextResult } from 'shared';
import { State, Selector, Action, StateContext } from '@ngxs/store';
import { GetContext } from './context.actions';
import { tap } from 'rxjs/operators';

export class AppContextStateModel {
    context?: GetContextResult;
}

@State<AppContextStateModel>({
    name: 'context',
    defaults: {
        context: { hausverwalter: null, mitarbeiter: [] }
    }
})
export class ContextState {

    constructor(private api: ApiService) { }

    @Selector()
    static context(state: AppContextStateModel) { return state.context; }

    @Action(GetContext)
    getContext(ctx: StateContext<AppContextStateModel>) {
        return this.api.getContext()
            .pipe(tap(context => ctx.patchState({ context })));
    }
}
